import"./modulepreload-polyfill-B5Qt9EMX.js";import{h as S,R as j,S as B,s as l,f as O,g as H,c as N,a as v,b as G,d as Q,e as V,i as A,M as P,j as z,k as F,l as K,B as M,m as R,n as J,o as X}from"./index-599OFMoc.js";const T=(t,e)=>{t.price=Math.round(t.price*(1-e))},Y=t=>{const n=t[Math.floor(Math.random()*t.length)];return Math.random()<.3&&S(n)?n:null},Z=t=>{alert(`번개세일! ${t.name}이(가) ${j*100}% 할인 중입니다!`)},tt=()=>Math.random()*1e4,et=(t,e)=>{const n=t.find(s=>s.id!==e&&S(s));return n||null},nt=t=>{alert(`${t.name}은(는) 어떠세요? 지금 구매하시면 ${B*100}% 추가 할인!`)},st=()=>Math.random()*2e4,d=(t,e,n)=>({type:t,props:e,children:n.flat(1/0).filter(s=>s===0||!!s)}),k=t=>t==null||typeof t=="boolean"?"":typeof t=="string"||typeof t=="number"?String(t):typeof t.type=="function"?k(t.type({...t.props,children:t.children})):{...t,children:t.children.map(k).filter(Boolean)},h=new Map;let D=null;function ot(t){D=t,h.forEach((e,n)=>{D.removeEventListener(n,q),D.addEventListener(n,q)})}function q(t){var n;let{target:e}=t;for(;e&&e!==D;){const s=(n=h.get(t.type))==null?void 0:n.get(e);s&&s.forEach(c=>c(t)),e=e.parentNode}}function $(t,e,n){h.has(e)||h.set(e,new WeakMap);const s=h.get(e);s.has(t)||s.set(t,new Set),s.get(t).add(n)}function w(t,e,n){const s=h.get(e);if(!s)return;const c=s.get(t);c&&(c.delete(n),c.size===0&&s.delete(t))}const I=t=>{if(t==null||typeof t=="boolean")return document.createTextNode("");if(typeof t=="string"||typeof t=="number")return document.createTextNode(t);if(Array.isArray(t)){const n=document.createDocumentFragment();return t.forEach(s=>n.appendChild(I(s))),n}const e=document.createElement(t.type);return ct(e,t.props??{}),e.append(...t.children.map(I)),e};function ct(t,e){Object.entries(e).forEach(([n,s])=>{if(n.startsWith("on")&&typeof s=="function"){const c=n.toLowerCase().slice(2);$(t,c,s)}else n==="className"?t.setAttribute("class",s):n==="style"&&typeof s=="object"?Object.assign(t.style,s):t.setAttribute(n,s)})}const U=(t,e,n,s=0)=>{if(!e&&n){t.removeChild(t.childNodes[s]);return}if(e&&!n){t.appendChild(I(e));return}if(typeof e=="string"||typeof e=="number"){if(e!==n){const i=document.createTextNode(String(e));t.replaceChild(i,t.childNodes[s])}return}if(e.type!==n.type){t.replaceChild(I(e),t.childNodes[s]);return}at(t.childNodes[s],e.props||{},n.props||{});const c=e.children||[],o=n.children||[],r=Math.max(c.length,o.length);for(let i=0;i<r;i++)U(t.childNodes[s],c[i],o[i],i)};function at(t,e,n){const s=e||{},c=n||{};Object.keys(c).forEach(o=>{if(!(o in s))if(o.startsWith("on")&&typeof c[o]=="function"){const r=o.toLowerCase().slice(2);w(t,r,c[o])}else t.removeAttribute(o)}),Object.keys(s).forEach(o=>{if(c[o]!==s[o])if(o==="className")t.className=s[o];else if(o.startsWith("on")&&typeof s[o]=="function"){const r=o.toLowerCase().slice(2);typeof c[o]=="function"&&w(t,r,c[o]),$(t,r,s[o])}else o==="style"&&typeof s[o]=="object"?Object.assign(t.style,s[o]):t.setAttribute(o,s[o])})}const L=new WeakMap,it=(t,e)=>{const n=L.get(e),s=k(t);n?U(e,s,n):e.appendChild(I(s)),L.set(e,s),ot(e)},rt=(t,e)=>{let n=0,s=0,c=0;for(let i=0;i<e.length;i++){const a=e[i],p=O(t,a.productId);s+=a.quantity;const u=p.price*a.quantity;c+=u;const m=Q(p,a.quantity);n+=u*(1-m)}let o=0;if(K(s)){const i=n*M,a=c-n;i>a?(n=c*(1-M),o=M):o=(c-n)/c}else o=(c-n)/c;const r=V();return n*=1-r,o=Math.max(o,r),[Math.round(n),o]},ut=()=>{const{products:t,cart:e}=l.getState(),[n,s]=rt(t,e),c=N(n),o=a=>{const{products:p,cart:u}=l.getState(),{target:m}=a,{productId:f}=m.dataset,g=p.find(x=>x.id===f),C=A(u,f),b=parseInt(m.dataset.change,10),E=C.quantity,y=E+b;if(y>0&&y<=g.quantity+E)g.quantity-=b,C.quantity=y,l.setState({cart:u});else if(y<=0){g.quantity-=b;const x=u.filter(W=>W.productId!==f);l.setState({cart:x})}else alert(P.outOfStock)},r=a=>{const{products:p,cart:u}=l.getState(),{target:m}=a,{productId:f}=m.dataset,g=A(u,f),C=p.find(y=>y.id===f),b=g.quantity;C.quantity+=b;const E=u.filter(y=>y.productId!==f);l.setState({cart:E})},i=()=>{const p=document.getElementById("product-select").value,u=O(t,p);if(u&&S(u)){const m=A(e,u.id);if(m){const f=m.quantity+1;z(u,f)?(m.quantity=f,u.quantity-=1):alert(P.outOfStock)}else{const f=F(u.id,1);l.setState({cart:[...e,f]}),u.quantity-=1}l.setState({lastSelectedProductId:p})}};return d("div",{className:"bg-gray-100 p-8"},[d("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"},[d("h1",{className:"text-2xl font-bold mb-4"},["장바구니"]),d("div",{id:"cart-items"},[e.map(a=>{const p=O(t,a.productId);return d("div",{id:a.productId,className:"flex justify-between items-center mb-2"},[d("span",void 0,[H(p,a.quantity)]),d("div",void 0,[d("button",{className:"quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1","data-product-id":a.productId,"data-change":"-1",onClick:o},["-"]),d("button",{className:"quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1","data-product-id":a.productId,"data-change":"1",onClick:o},["+"]),d("button",{className:"remove-item bg-red-500 text-white px-2 py-1 rounded","data-product-id":a.productId,onClick:r},["삭제"])])])})]),d("div",{id:"cart-total",className:"text-xl font-bold my-4"},[`총액: ${n}원`,s>0?d("span",{className:"text-green-500 ml-2"},[`(${(s*100).toFixed(1)}% 할인 적용)`]):null,d("span",{id:"loyalty-points",className:"text-blue-500 ml-2"},[`(포인트: ${c})`])]),d("select",{id:"product-select",className:"border rounded p-2 mr-2"},[t.map(a=>d("option",{value:a.id,...!S(a)&&{disabled:!S(a)}},[v(a)]))]),d("button",{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:i},["추가"]),d("div",{id:"stock-status",className:"text-sm text-gray-500 mt-2"},[t.map(a=>G(a))])])])},dt=()=>{const t={},e=(o,r,i)=>{t[o]||(t[o]={}),t[o][r]=i},n=o=>{const r=t[o.type];if(!r)return;const i=Object.keys(r).find(a=>o.target.matches(a));i&&r[i](o)};let s=!1;return{addEvent:e,registerEvents:()=>{s||(s=!0,Object.keys(t).forEach(o=>{document.body.addEventListener(o,n)}))}}},lt=dt(),_=()=>{const t=document.getElementById("app");it(ut(),t)};function ft(){const t=R();l.setState({products:R()}),l.setState({lastSelectedProductId:t[0].id}),l.subscribe(_),_(),lt.registerEvents(),setTimeout(()=>{setInterval(()=>{const{products:e}=l.getState(),n=Y(e);n&&(T(n,j),Z(n),l.setState({products:e}))},J)},tt()),setTimeout(()=>{setInterval(()=>{const{lastSelectedProductId:e,products:n}=l.getState();if(e){const s=et(n,e);s&&(nt(s),T(s,B),l.setState({products:n}))}},X)},st())}ft();
